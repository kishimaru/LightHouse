@isTest
public class con_ProfileReopenTest {

        public static testMethod void testMyController() {
        
        // Create test data
        Contact ct = new Contact(FirstName='MyFirst', LastName='MyLast');
        insert ct;

        date bdate = date.parse('7/9/1977');
        Profile__c pr = new Profile__c(Name='MyProfile', Contact__c=ct.Id, Birthdate__c=bdate);
        insert pr;
        
        // Start test
        Test.startTest();
        ApexPages.StandardController conProf = new ApexPages.StandardController(pr);
        con_ProfileReopen ext = new con_ProfileReopen(conProf);

        // Set starting page
        String stPage = '/'+pr.Id;
        String pageURL = '/apex/ProfileReopen?id='+pr.Id+'&retURL=/'+pr.Id;
        PageReference pageRef = new PageReference(pageURL);
        Test.setCurrentPage(pageRef);
            
        // After save, check to see if new note was created and if Profile record has the right info in it.     
        DateTime d = Date.Today() ;
        String dateStr =  d.format('dd/MM/yyyy') ;
		ext.ReopenDetails = 'Moved back';
        
        PageReference retPage = ext.Save_And_Archive();
        
        Profile__c upPr = [SELECT Date_Closed_Archived__c, Closure_Details__c FROM Profile__c WHERE Id =: pr.Id];
        Note nt = [SELECT Title, Body FROM Note WHERE ParentID =: pr.Id];
        
        System.assert(nt.Title.contains(dateStr));
        System.assertEquals(upPr.Date_Closed_Archived__c, null); 
        System.assertEquals(nt.Body, ext.ReopenDetails);
        System.assertEquals(stPage.substring(0,15), retPage.getURL().substring(0,15));

		Test.stopTest();
        }
}